# -*- python -*- 

import sys
Import('env')

if not (env['HAVE_BLUEZ'] or sys.platform == 'darwin'):
    env['HAVE_WIIUSE'] = 0
    Return()

files = [
	"classic.c",
        "dynamics.c",
        "events.c",
        "io.c",
        "ir.c",
        "nunchuk.c",
        "guitar_hero_3.c",
        "wiiuse.c",
	]

if env['HAVE_BLUEZ']:
	files += [ "io_nix.c", ]

if sys.platform == 'darwin':
	files += [ "io_osx.c", ]

if sys.platform == 'darwin':
	env_wiiuse = env.Clone(
		CCFLAGS = env.filterWarnings(env['CCFLAGS']) + ' -fvisibility=default -x objective-c++',
		CXXFLAGS = env.filterWarnings(env['CXXFLAGS']) + ' -x objective-c++',
		)
else:
	env_wiiuse = env.Clone(
		CCFLAGS = env.filterWarnings(env['CCFLAGS']) + ' -fvisibility=default',
		CXXFLAGS = env.filterWarnings(env['CXXFLAGS']),
		)

libs = [
    'm',
]

if sys.platform == 'darwin':
    env_wiiuse.StaticLibrary(env['libs_dir']+"wiiuse", files, LIBS=libs)
else:
    env_wiiuse.SharedLibrary(env['libs_dir']+"wiiuse", files, LIBS=libs)

env['HAVE_WIIUSE'] = 1
